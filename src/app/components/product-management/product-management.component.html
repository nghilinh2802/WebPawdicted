<div class="container" [style.background-color]="'#f8f1f1'">
  <h1 class="title" [style.color]="'#9c162c'">Product Management</h1>

  <div class="actions">
    <button class="add-btn" (click)="openAddModal()">Add Product</button>
    <button class="delete-btn" (click)="deleteSelected()">Delete Selected</button>
    <button class="flashsale-btn" (click)="createFlashsale()">Create Flashsale</button>
  </div>

  <div class="search-filter">
    <select [(ngModel)]="sortFilter" (change)="applyFilters()" class="filter-select">
      <option value="">Sort By</option>
      <option value="name_asc">Name (A-Z)</option>
      <option value="name_desc">Name (Z-A)</option>
      <option value="date_asc">Oldest</option>
      <option value="date_desc">Newest</option>
    </select>

    <select [(ngModel)]="categoryFilter" (change)="applyFilters()" class="filter-select">
      <option value="">All Categories</option>
      <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
    </select>

    <input type="text" [(ngModel)]="searchTerm" (input)="applyFilters()" placeholder="Search by name or ID" class="search-input">
  </div>

  <div class="table-container">
    <table class="product-table">
      <thead>
        <tr>
          <th><input type="checkbox" (change)="toggleSelectAll($event)"></th>
          <th>ID</th>
          <th>Product Name</th>
          <th>Variants</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Category</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let product of filteredProducts">
          <tr [attr.data-product-id]="product.product_id" class="product-row">
            <td><input type="checkbox" [checked]="selectedProductIds.has(product.product_id)" (change)="toggleProductSelection(product.product_id)"></td>
            <td>{{ product.product_id }}</td>
            <td>{{ product.product_name }}</td>
            <td>
              <span *ngIf="product.variant_id.length" class="variant-link" (click)="toggleVariants(product.product_id)" [style.color]="'#9c162c'">{{ product.variant_id.length }} variants</span>
              <span *ngIf="!product.variant_id.length">None</span>
            </td>
            <td>{{ product.quantity }}</td>
            <td>{{ product.price | currency:'VND' }}</td>
            <td>{{ product.category_id }}</td>
            <td><img [src]="product.product_image || 'https://via.placeholder.com/60'" alt="Product Image" class="product-image"></td>
            <td class="action-links">
              <button class="details-btn" (click)="openDetailsModal(product.product_id)">Details</button>
              <button class="edit-btn" (click)="openEditModal(product.product_id)">Edit</button>
              <button class="delete-btn" (click)="deleteProduct(product.product_id)">Delete</button>
            </td>
          </tr>
          <tr *ngFor="let variant of product.variants" [attr.data-parent-id]="product.product_id" [attr.data-variant-id]="variant.variant_id" class="variant-row" [class.show]="expandedProductIds.has(product.product_id)">
            <td><input type="checkbox" [checked]="selectedVariantIds.has(variant.variant_id)" (change)="toggleVariantSelection(variant.variant_id)"></td>
            <td>{{ variant.variant_id }}</td>
            <td></td>
            <td>{{ variant.variant_name }}</td>
            <td>{{ variant.quantity }}</td>
            <td>{{ variant.price | currency:'VND' }}</td>
            <td></td>
            <td><img [src]="variant.image || 'https://via.placeholder.com/60'" alt="Variant Image" class="variant-image"></td>
            <td></td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>

<app-add-product-modal *ngIf="showAddModal" (close)="showAddModal = false"></app-add-product-modal>
<app-edit-product-modal *ngIf="showEditModal" [productId]="selectedProductId" (close)="showEditModal = false"></app-edit-product-modal>
<app-product-details-modal *ngIf="showDetailsModal" [productId]="selectedProductId" (close)="showDetailsModal = false"></app-product-details-modal>